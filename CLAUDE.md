
# CLAUDE.md

## ğŸ“Œ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
Gmail AI Classifier

## ğŸ§  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
Gmail ã§å—ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚’æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã§è‡ªå‹•åˆ†é¡ã—ã€å†…å®¹ã«å¿œã˜ã¦ **LINE Messaging API** ã¸ã®é€šçŸ¥ã‚„ **Google Sheets** ã¸ã®è¨˜éŒ²ã‚’è¡Œã† PoCï¼ˆæ¦‚å¿µå®Ÿè¨¼ï¼‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚  
Flask è£½ã® API ã‚’ n8nï¼ˆDocker æ°¸ç¶šåŒ–ï¼‰ã‹ã‚‰å‘¼ã³å‡ºã—ã€åˆ†é¡ âœ ä»˜åŠ æƒ…å ±ä»˜ä¸ âœ é€šçŸ¥ãƒ»ä¿å­˜ã¾ã§ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚

> **Claude Code åˆ©ç”¨æ™‚ã®ç‹™ã„**ï¼š  
> - **å†ç¾æ€§** â€” ã‚³ãƒ¼ãƒ‰ãƒ»æ§‹æˆãƒ»ä¾å­˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å›ºå®š  
> - **å®‰å…¨æ€§** â€” æ©Ÿå¯†æƒ…å ±ã®ç§˜åŒ¿ã¨æœ€å°æ¨©é™è¨­è¨ˆ  
> - **èª­ã¿ã‚„ã™ã•** â€” ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç²’åº¦ã§è²¬å‹™ã‚’æ˜ç¢ºåŒ–

---

## ğŸ§° æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
| åˆ†é¡ | æ¡ç”¨æŠ€è¡“ | å‚™è€ƒ |
|------|----------|------|
| è¨€èª | Python 3.10 ä»¥ä¸Š | 3.12 ç³»ã§ã‚‚æ¤œè¨¼æ¸ˆã¿ |
| Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Flask 2.3.3 | Blueprint åˆ†å‰² |
| æ©Ÿæ¢°å­¦ç¿’ | scikit-learnï¼ˆTF-IDF + LinearSVCï¼‰ | spaCy ã«å·®ã—æ›¿ãˆå¯ |
| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | n8n + Docker Compose | volumes ã§å®Œå…¨æ°¸ç¶šåŒ– |
| è£œåŠ© | MCPï¼ˆModel Context Protocolï¼‰ | æ–‡è„ˆå¼·åŒ– |
| å¤–éƒ¨ API | Gmail (IMAP), LINE Messaging, Google Sheets | ã™ã¹ã¦ OAuth2 / ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¯¾å¿œ |

---

## ğŸ—‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
```
/gmail-classifier/
â”œâ”€â”€ app/                # Flask Blueprintsï¼ˆpredict, enrich ãªã©ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ predict/        # æ¨è«–ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ enrich/         # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜åŠ 
â”œâ”€â”€ models/             # å­¦ç¿’æ¸ˆãƒ¢ãƒ‡ãƒ«ãƒ»å†å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ n8n/                # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾© (*.json)
â”œâ”€â”€ scripts/            # è£œåŠ©ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆãƒ­ã‚°æƒé™¤ç­‰ï¼‰
â”œâ”€â”€ tests/              # pytest
â”œâ”€â”€ config/             # config.py, .env.sample
â”œâ”€â”€ data/               # å­¦ç¿’ç”¨ CSV / Parquet
â”œâ”€â”€ docs/               # ä»•æ§˜æ›¸ãƒ»ADR ãªã©
â”œâ”€â”€ docker/             # Dockerfile, docker-compose.yml
â”œâ”€â”€ run.py              # é–‹ç™ºç”¨ãƒ©ãƒ³ãƒãƒ£ãƒ¼
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```
> ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã¯ `snake_case`ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã¯ `lower_snake_case`ã€ã‚¯ãƒ©ã‚¹åã¯ `UpperCamelCase` ã‚’æ¨å¥¨ã€‚

---

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & ç§˜åŒ¿æƒ…å ±

1. `.env.sample` ã‚’ãƒ™ãƒ¼ã‚¹ã«å„è‡ª `.env` ã‚’ä½œæˆã€‚  
2. `.gitignore` ã« `.env`, `*.pkl`, `data/raw/`, `logs/` ã‚’è¿½åŠ ã€‚  
3. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼ã¯æœ€å°ã‚¹ã‚³ãƒ¼ãƒ—ã«é™å®šã€‚  
4. n8n ã¯ Basic Auth + å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ä¿è­·ã€‚

---

## ğŸ“ é–‹ç™ºãƒ«ãƒ¼ãƒ«

- PEP 8 + Black + isort
- pre-commitï¼šruff, mypy, pytest ã‚’ãƒ•ãƒƒã‚¯
- docs/adr/ ã« ADR ã‚’ Markdown å½¢å¼ã§ä¿å­˜
- GitHub Actionsï¼šCI å®Ÿè¡Œï¼ˆpytest + flake8 + safetyï¼‰

---

## ğŸš€ ãƒ“ãƒ«ãƒ‰ / ãƒ†ã‚¹ãƒˆ / ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt

# Flask
flask run --reload

# ãƒ¢ãƒ‡ãƒ«å†å­¦ç¿’
python models/train_model.py

# ãƒ†ã‚¹ãƒˆ
pytest -q

# n8n èµ·å‹•
docker compose -f docker/docker-compose.yml up -d
```

---

## ğŸ› ï¸ é‹ç”¨è£œåŠ©ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ç›®çš„ |
|------------|------|
| clean_n8n_logs.sh | n8n ãƒ­ã‚°æƒé™¤ |
| fix_encoding_server.py | Base64/æ–‡å­—ã‚³ãƒ¼ãƒ‰å¾©å…ƒ |
| backup_gsheet.py | Sheets ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |

---

## ğŸ“ FAQ

| Q | A |
|---|---|
| ãƒ¢ãƒ‡ãƒ«ç²¾åº¦ãŒä½ã„ | æ•™å¸«ãƒ‡ãƒ¼ã‚¿ã‚’å¢—ã‚„ã—ã€ãƒã‚¤ãƒ‘ãƒ©æœ€é©åŒ– |
| é€šçŸ¥ãŒæ¥ãªã„ | `.env` è¨­å®š & Webhook URL ã‚’ç¢ºèª |
| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¶ˆå¤± | Docker volume æ°¸ç¶šåŒ–è¨­å®šã‚’ç¢ºèª |

---

## ğŸ”– Changelog

| Version | Date | Summary |
|---------|------|---------|
| 0.2.0 | 2025-07-13 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŒ‡é‡ãƒ»CI è¿½è¨˜ |
| 0.1.0 | 2025-07-11 | åˆç‰ˆä½œæˆ |

---

## ğŸ›‘ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
MIT Licenseã€‚API åˆ©ç”¨è¦ç´„ã®éµå®ˆã‚’å³å®ˆã€‚
